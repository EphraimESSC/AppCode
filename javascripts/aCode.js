var a=angular.module("myapp",[]);a.directive("enhanceUi",function(){return{restrict:"A",link:function(d,c,b){var f=d.$eval(b.enhanceUi),e=f.event,g=f.condition;FunctionalityModule.enhancePage();$(c.parent()).trigger("updatelayout").listview("refresh")}}});a.factory("Data",function(){return{RadioGroupCount:0,SliderCount:0,SelectMenuCount:0,TextLabel:"",SelectedControls:{},ClassificationDataAdded:[],sharedData:{controls:{},classificationData:[]}}});a.run(function(b,c){});a.controller("ClassificationListController",["$scope",function(b){b.data={}}]);a.controller("ConfigureClassificationController",["$scope","Data",function(b,c){b.sharedData=c.sharedData;b.showRestartSection=false;DataModule.execute("classification","selectData",[],function(d){var f=d.rows;if(f===undefined){return}var e={};angular.forEach(f,function(h,g){if(h.parentClassificationId===null){if(e[h.classificationId]==undefined){var i={data:{classificationInsertId:h.classificationId,id:h.classificationId,name:h.classificationName,value:false},subCategoryInput:"",categorieschildren:[]};e[h.classificationId]=i}}else{if(e[h.parentClassificationId]!==undefined){e[h.parentClassificationId].categorieschildren.push({data:{classificationInsertId:h.classificationId,id:""+h.parentClassificationId+h.classificationId,name:h.classificationName,value:false},subCategoryInput:""})}}});angular.forEach(e,function(g,h){c.sharedData.classificationData.push(g)});b.$apply()});b.restartApplication=function(){$("[data-url]").remove();window.location.reload()};b.addClassification=function(){if(b.inputClassificationName===undefined||b.inputClassificationName===""){return}DataModule.execute("classification","insertData",[b.inputClassificationName,null],function(d){FunctionalityModule.addClassificationName(d.insertId,b.inputClassificationName);c.sharedData.classificationData.push({data:{id:d.insertId,name:b.inputClassificationName,value:false},name:"",categorieschildren:[]});b.inputClassificationName="";b.$apply();FunctionalityModule.enhancePage();$(".js-classify-diagnose-button").removeClass("ui-disabled")});b.showRestartSection=true};b.addSubClassification=function(f,e){var d=c.sharedData.classificationData[e].subCategoryInput;if(d===undefined||d===""){return}DataModule.execute("classification","insertData",[d,f],function(g){var h=g.insertId;c.sharedData.classificationData[e].categorieschildren.push({data:{name:d,id:h,value:false}});c.sharedData.classificationData[e].subCategoryInput="";b.$apply()});b.showRestartSection=true};b.deleteClassification=function(e,d){DataModule.execute("classification","deleteData",[e],function(){c.sharedData.classificationData.splice(d,1);b.$apply()},"delete");b.showRestartSection=true};b.deleteSubCategory=function(f,g){var e=b.sharedData.classificationData.map(function(j,h){if(j.id===g){return h}}).filter(isFinite)[0];var d=c.sharedData.classificationData[e].categorieschildren.map(function(j,h){if(j.subCategoryInsertId===f){return h}}).filter(isFinite)[0];DataModule.execute("classification","deleteData",[f],function(){c.sharedData.classificationData[e].categorieschildren.splice(d,1);b.$apply()},"delete");b.showRestartSection=true}}]);a.controller("DiagnoseController",["$scope","$compile","Data",function(b,d,c){b.SelectedControls=c.SelectedControls;b.sharedData=c.sharedData;b.ClassificationDataAdded=c.ClassificationDataAdded;FunctionalityModule.setSharedData(c.sharedData);DiagnoseTabFunctionality.setDataControls(c);b.$watch("sharedData.controls",function(g,f){if(g===f){return}var h=d('<r controls="sharedData.controls"></r>')(b);var i=angular.element(document.getElementById("ControlsContainer"));i.append(h)});b.$watch("sharedData.classificationData",function(f,e){angular.forEach(c.ClassificationDataAdded,function(h,j){var g=angular.copy(c.sharedData.classificationData);updateId(h.controlId,h.uniqueProperty,g);h.classification.categorieschildren=g});setTimeout(function(){$("#defaultPage").enhanceWithin()},1)},true);b.saveDiagnoseItemsData=function(){DiagnoseTabFunctionality.saveDiagnoseData(c)}}]);function updateId(d,b,c){angular.forEach(c,function(e,f){e.data.id=d+b+e.data.id;e.data.diagnoseControlId=d;if(e.categorieschildren){updateId(d,b,e.categorieschildren)}})}function updateParentInfo(){};function createDirective(b){return function(e,c,d){return{restrict:"E",scope:{controls:"=",groupname:"=",parent:"=",uniqueProperty:"@"},compile:function(g,f){return{pre:function(j,k,i){if(b==="r"&&j.uniqueProperty!==undefined){d.uniqueProperty=j.uniqueProperty}if(j.controls===undefined||j.controls.type===undefined){return}var h=c.get(j.controls.type);if(j.controls.type==="RadioGroup"){h=processRadioGroup(j,d,c,h)}if(j.controls.type==="CheckboxGroup"){processCheckboxGroup(j)}if(j.controls.type==="RadioButton"){j.controls.uniqueProperty=d.uniqueProperty}if(j.controls.type==="Checkbox"){h=processCheckbox(j,d,c,h)}if(j.controls.type==="TextInput"){h=processTextInput(j,d,c,h)}if(j.controls.type==="Text"){d.TextLabel=j.controls.properties.text}if(j.controls.type==="ToggleSwitch"){h=processToggleSwitch(j,d,c,h)}if(j.controls.type==="Slider"){h=processSlider(j,d,c,h,k)}if(j.controls.type==="Grid"){processGrid(j)}if(j.controls.type==="SelectMenu"){h=processSelectMenu(j,d,c,h,k)}var l=angular.element(h);e(l)(j);k.append(l)},post:function(i,j,h){if(i.controls.type==="Tabs"){setTimeout(function(){$("#defaultPage").enhanceWithin();$(j).tabs();$(j).data("tabsInitialized",true)},1)}if(i.controls.type==="Slider"){i.$on("$destroy",function(k){j.off("change")})}}}}}}}a.directive("r",createDirective("r"));a.directive("content",createDirective("content"));a.directive("radiogroup",createDirective("radiogroup"));a.directive("checkboxgroup",createDirective("checkboxgroup"));a.directive("tabs",function(c,b){var d={};d.restrict="E";d.compile=function(e,f){return{pre:function(j,g,i,k){var h="";h=b.get("Tabs");var l=angular.element(h);c(l)(j);g.append(l)},post:function(i,g,h){setTimeout(function(){$("#defaultPage").enhanceWithin();$(g).tabs();$(g).data("tabsInitialized",true)},1)}}};d.scope={controls:"="};d.controller=function(){};return d});a.directive("categories",["$compile","$templateCache","Data",function(d,b,c){var e={};e.restrict="E";e.scope={categorieschildren:"=",parent:"="};e.compile=function(g,f){return{pre:function(l,i,k,m){var j="",h="";h="CategoriesButtons";if(l.categorieschildren!==undefined){angular.forEach(l.categorieschildren,function(o,p){if(o.categorieschildren&&o.categorieschildren.length>0){h="CategoriesTabs";return}})}if(l.categorieschildren){angular.forEach(l.categorieschildren,function(o,p){l.$watch("categorieschildren["+p+"].data",function(r,q){if(r.value===true||r.value==="true"){if(c.SelectedControls[r.diagnoseControlId].categoriesInfo===undefined){c.SelectedControls[r.diagnoseControlId].categoriesInfo={}}c.SelectedControls[r.diagnoseControlId].categoriesInfo[r.id]=r}else{if(r.value===false&&q.value===true||r.value==="false"&&q.value==="true"){if(c.SelectedControls!==undefined&&c.SelectedControls[r.diagnoseControlId]!==undefined&&c.SelectedControls[r.diagnoseControlId].categoriesInfo!==undefined&&c.SelectedControls[r.diagnoseControlId].categoriesInfo[r.id]!==undefined){c.SelectedControls[r.diagnoseControlId].categoriesInfo[r.id]=undefined;delete c.SelectedControls[r.diagnoseControlId].categoriesInfo[r.id]}}}},true)})}j=b.get(h);var n=angular.element(j);d(n)(l);i.append(n)},post:function(j,h,i){setTimeout(function(){$("#defaultPage").enhanceWithin();$(h).find(".categories-tabs").tabs().data("tabs-initialized","true")},1)}}};e.controller=function(f){};return e}]);function processRadioGroup(e,c,a,d){c.RadioGroupCount+=1;e.controls.groupname="RadioGroup"+c.RadioGroupCount;e.controls.name=e.controls.properties.legend;if(e.controls.properties.id===undefined){e.controls.properties.id="RadioGroup"+c.RadioGroupCount}e.$watch("controls",function(g,f){if(g.value!==undefined){c.SelectedControls[g.properties.id]={label:g.properties.legend,type:g.type,valueLabel:g.value,value:g.value};e.controls.showCategory=true}else{c.SelectedControls[g.properties.id]=undefined;delete c.SelectedControls[g.properties.id];e.controls.showCategory=false}},true);d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d}function processCheckboxGroup(a){a.controls.name=a.controls.properties.legend;angular.forEach(a.controls.children,function(c,b){c.name=a.controls.name})}function processCheckbox(e,c,a,d){e.controls.uniqueProperty=c.uniqueProperty;e.controls.properties.id=c.uniqueProperty+e.controls.properties.id;e.$watch("controls",function(g,f){if(g.value===true){c.SelectedControls[g.properties.id]={label:g.name,type:g.type,valueLabel:g.properties.label,value:g.value};e.controls.showCategory=true}else{if(c.SelectedControls[g.properties.id]!==undefined){c.SelectedControls[g.properties.id]=undefined;delete c.SelectedControls[g.properties.id]}e.controls.showCategory=false}},true);d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d}function processSlider(e,c,a,d,f){e.controls.value=0;e.controls.uniqueProperty=c.uniqueProperty;e.controls.properties.id=c.uniqueProperty+e.controls.properties.id;f.on("change",'input[type="number"]',function(){e.controls.value=parseInt($(this).val());e.$apply()});e.$watch("controls",function(h,g){if(h.value!==0&&h.value!==g.value){c.SelectedControls[h.properties.id]={label:h.properties.label,type:h.type,valueLabel:h.value,value:h.value};e.controls.showCategory=true}else{if(g.value!==0&&h.value===0){if(c.SelectedControls[h.properties.id]!==undefined){c.SelectedControls[h.properties.id]=undefined;delete c.SelectedControls[h.properties.id]}e.controls.showCategory=false}}},true);d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d}function processTextInput(e,c,a,d){e.controls.uniqueProperty=c.uniqueProperty;e.controls.properties.id=c.uniqueProperty+e.controls.properties.id;e.$watch("controls",function(g,f){if(g.value!==undefined&&g.value!==""){c.SelectedControls[g.properties.id]={label:g.properties.label,type:g.type,valueLabel:g.value,value:g.value};e.controls.showCategory=true}else{if(c.SelectedControls[g.properties.id]!==undefined){c.SelectedControls[g.properties.id]=undefined;delete c.SelectedControls[g.properties.id]}e.controls.showCategory=false}},true);d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d}function processToggleSwitch(e,c,a,d){c.SliderCount+=1;if(e.controls.properties.id===undefined){e.controls.properties.id="ToggleSwitch"+c.SliderCount}e.controls.properties.label=c.TextLabel;c.TextLabel="";e.controls.uniqueProperty=c.uniqueProperty;e.controls.properties.id=c.uniqueProperty+e.controls.properties.id;e.controls.value="false";e.$watch("controls",function(g,f){if(g.value==="true"&&f.value==="false"){c.SelectedControls[g.properties.id]={label:g.properties.label,type:g.type,valueLabel:g.properties.label1,value:g.value};e.controls.showCategory=true}else{if(g.value==="false"){c.SelectedControls[g.properties.id]=undefined;delete c.SelectedControls[g.properties.id];e.controls.showCategory=false}}},true);d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d}function processGrid(a){var c=a.controls;var b=c.properties&&c.properties.rows?c.properties.rows:1;if(c.properties===undefined){c.properties={}}c.properties.uiClass=GridBuilder.getGridClass(c.children,b);GridBuilder.setGridControlLabels(c)}function processSelectMenu(e,c,a,d,f){c.SelectMenuCount+=1;if(e.controls.properties.id===undefined){e.controls.properties.id="SelectMenu"+c.SelectMenuCount}if(e.controls.properties.options.children){e.controls.previousValue=e.controls.value=e.controls.defaultValue=e.controls.properties.options.children[0].value;e.controls.previousValueLabel=e.controls.valueLabel=e.controls.defaultValueLabel=e.controls.properties.options.children[0].text}f.on("change","select.control",function(i){var h=$(this).val();var g=$('option[value="'+h+'"]:selected',$(this)).text();if(h!==e.controls.previousValue&&h!==e.controls.defaultValue||g!==e.controls.previousValueLabel&&g!==e.controls.defaultValueLabel){e.controls.previousValue=e.controls.value;e.controls.previousValueLabel=e.controls.valueLabel;e.controls.value=h;e.controls.valueLabel=g;c.SelectedControls[e.controls.properties.id]={label:e.controls.properties.options.label,type:e.controls.type,valueLabel:e.controls.valueLabel,value:e.controls.value};e.controls.showCategory=true}else{c.SelectedControls[e.controls.properties.id]=undefined;delete c.SelectedControls[e.controls.properties.id];e.controls.showCategory=false}e.$apply()});d+=a.get("CategoriesRoot");var b=angular.copy(c.sharedData.classificationData);updateId(e.controls.properties.id,c.uniqueProperty,b);c.ClassificationDataAdded.push({controlId:e.controls.properties.id,uniqueProperty:c.uniqueProperty,classification:b});e.controls.categorieschildren=b;return d};
