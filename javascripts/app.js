var clientList=[{name:"Paul",age:"20",dateHourOfBirth:"2003-04-16T13:59",sex:"male",address:"Lisbon,\nPortugal",phone:"+493 3 345 44",email:"Paul@xyz.com",diagnoseDetais:[{diagnoseName:"Test Diagnosis 1 1",clientId:"1",date:"today"},{diagnoseName:"Test Diagnosis 2 1",clientId:"1",date:"yesterday"}]},{name:"Paul Abdul",age:"60",dateHourOfBirth:"1943-04-26T13:59",sex:"male",address:"Lisbon",phone:"+493 5363543 345 44",email:"PaulAbdul@xyz.com",diagnoseDetais:[{diagnoseName:"Test Diagnosis 1 2",clientId:"2",date:"today"},{diagnoseName:"Test Diagnosis 2 2",clientId:"2",date:"yesterday"}]},{name:"Matilda",age:"45",dateHourOfBirth:"1974-04-05T13:59",sex:"female",address:"Lisbon",phone:"+493 94932 345 44",email:"Matilda@xyz.com",diagnoseDetais:[{diagnoseName:"Test Diagnosis 1 3",clientId:"3",date:"today"},{diagnoseName:"Test Diagnosis 2 3",clientId:"3",date:"yesterday"}]}];var DataModule=function(f,g){var q={initialize:D,createAllTables:e,dropAllTables:r,getClientList:m,getColumnData:s,insertClientData:A,updateClientData:b,insertDiagnoseData:j,insertTestData:t,getDiagnoseList:h,deleteDiagnoseData:w,clearTable:p,getData:l,updateData:o,executeQuery:x,execute:v,executeAll:k,executeQuery:x,CLASSIFICATION:"classification"};var B=null,y={createClientTable:"CREATE TABLE IF NOT EXISTS CLIENT_DATA (id INTEGER PRIMARY KEY, name, age, dateHourOfBirth, sex, address, phone, email)",insertClientData:"INSERT INTO CLIENT_DATA (name, age, dateHourOfBirth, sex, address, phone, email)  VALUES (?, ?, ?, ?, ?, ?, ?)",dropClientTable:"DROP TABLE CLIENT_DATA",createDiagnoseTable:"CREATE TABLE IF NOT EXISTS DIAGNOSE_DATA (id INTEGER PRIMARY KEY, diagnoseId INTEGER, controlId, controlLabel, controlType, controlValue, classification)",insertDiagnoseData:"INSERT INTO DIAGNOSE_DATA (diagnoseId, controlId, controlLabel, controlType, controlValue)  VALUES (?, ?, ?, ?, ?)",createClassificationTable:"CREATE TABLE IF NOT EXISTS CLASSIFICATION_DATA (id INTEGER PRIMARY KEY, classificationName)",insertClassificationData:"INSERT INTO CLASSIFICATION_DATA (classificationName) VALUES (?)",createDiagnoseControlsTable:"CREATE TABLE IF NOT EXISTS DIAGNOSE_CONTROLS_DATA  (id INTEGER PRIMARY KEY, diagnoseName, diagnoseControlFile, diagnoseControlFileContent)",insertDiagnoseControsData:"INSERT INTO DIAGNOSE_CONTROLS_DATA (diagnoseName, diagnoseControlFile, diagnoseControlFileContent)VALUES (?, ?, ?)"};function D(){B=openDatabase("DataDB","1.0","Data DB",2*1024*1024,function(E){},function(E){alert("Error: DB creation : "+E.message)})}var C={clientData:{tableName:"CLIENT_DATA",queries:{createTable:"CREATE TABLE IF NOT EXISTS CLIENT_DATA (id INTEGER PRIMARY KEY, name, age, dateHourOfBirth, sex, address, phone, email)",selectData:"SELECT * FROM CLIENT_DATA",selectDataWhere:"SELECT * FROM CLIENT_DATA WHERE id=?",insertData:"INSERT INTO CLIENT_DATA (name, age, dateHourOfBirth, sex, address, phone, email) VALUES (?, ?, ?, ?, ?, ?, ?)",deleteData:"DELETE FROM CLIENT_DATA WHERE id=?",dropTable:"DROP TABLE CLIENT_DATA"}},clientDiagnoseData:{tableName:"CLIENT_DIAGNOSE_DATA",columnMapping:{id:"uniqueId","Client ID":"clientId"},queries:{createTable:"CREATE TABLE IF NOT EXISTS CLIENT_DIAGNOSE_DATA (id INTEGER PRIMARY KEY, clientId INTEGER, diagnoseIdForClient, diagnoseName, date)",selectData:"SELECT * FROM CLIENT_DIAGNOSE_DATA",selectDataWhere:"SELECT * FROM CLIENT_DIAGNOSE_DATA WHERE clientId=?",selectDataWhereId:"SELECT * FROM CLIENT_DIAGNOSE_DATA WHERE id=?",insertData:"INSERT INTO CLIENT_DIAGNOSE_DATA (clientId, diagnoseIdForClient, diagnoseName, date) VALUES (?, ?, ?, ?)",getCountWhere:"SELECT COUNT(1) FROM CLIENT_DIAGNOSE_DATA WHERE clientId=?",deleteData:"DELETE FROM CLIENT_DIAGNOSE_DATA WHERE id=?",dropTable:"DROP TABLE CLIENT_DIAGNOSE_DATA"}},diagnoseData:{tableName:"DIAGNOSE_DATA",queries:{createTable:"CREATE TABLE IF NOT EXISTS DIAGNOSE_DATA (id INTEGER PRIMARY KEY, diagnoseId INTEGER, controlId, controlLabel, controlType, controlValueLabel, controlValue, classification)",selectData:"SELECT * FROM DIAGNOSE_DATA",selectDataWhere:"SELECT * FROM DIAGNOSE_DATA WHERE diagnoseId=?",insertData:"INSERT INTO DIAGNOSE_DATA (diagnoseId, controlId, controlLabel, controlType, controlValueLabel, controlValue) VALUES (?, ?, ?, ?, ?, ?)",deleteData:"DELETE FROM DIAGNOSE_DATA WHERE diagnoseId=?",deleteDataWhere:"DELETE FROM DIAGNOSE_DATA WHERE controlId=(?||'%')",dropTable:"DROP TABLE DIAGNOSE_DATA"}},classification:{tableName:"CLASSIFICATION_DATA",queries:{createTable:"CREATE TABLE IF NOT EXISTS CLASSIFICATION_DATA (id INTEGER PRIMARY KEY, classificationName)",selectData:"SELECT * FROM CLASSIFICATION_DATA",insertData:" INSERT INTO CLASSIFICATION_DATA (classificationName) VALUES (?) ",deleteData:"DELETE FROM CLASSIFICATION_DATA WHERE id=?",dropTable:"DROP TABLE CLASSIFICATION_DATA"}},diagnoseClassification:{tableName:"DIAGNOSE_CLASSIFICATION",queries:{createTable:"CREATE TABLE IF NOT EXISTS DIAGNOSE_CLASSIFICATION (id INTEGER PRIMARY KEY, diagnoseItemId, classificationId)",selectData:"SELECT * FROM DIAGNOSE_CLASSIFICATION",selectDataWhere:"SELECT * FROM DIAGNOSE_CLASSIFICATION WHERE diagnoseItemId=?",getCountWhere:"SELECT COUNT(1) FROM DIAGNOSE_CLASSIFICATION WHERE diagnoseItemId=?",insertData:"INSERT INTO DIAGNOSE_CLASSIFICATION (diagnoseItemId, classificationId) VALUES (?, ?)",deleteData:"DELETE FROM DIAGNOSE_CLASSIFICATION WHERE id=?",deleteDataWhere:"DELETE FROM DIAGNOSE_CLASSIFICATION WHERE diagnoseItemId=?",dropTable:"DROP TABLE DIAGNOSE_CLASSIFICATION"}},diagnoseControls:{tableName:"DIAGNOSE_CONTROLS_DATA",queries:{createTable:"CREATE TABLE IF NOT EXISTS DIAGNOSE_CONTROLS_DATA (id INTEGER PRIMARY KEY, tabIndex INTEGER, subTabIndex INTEGER, diagnoseName, subTabName, diagnoseControlFile, diagnoseControlFileContent, classify)",selectData:"SELECT * FROM DIAGNOSE_CONTROLS_DATA",selectDataWhere:"SELECT * FROM DIAGNOSE_CONTROLS_DATA WHERE tabIndex=?",insertData:" INSERT INTO DIAGNOSE_CONTROLS_DATA (tabIndex, subTabIndex, diagnoseName, subTabName, diagnoseControlFile, diagnoseControlFileContent, classify) VALUES (?, ?, ?, ?, ?, ?, ?) ",updateData:"UPDATE DIAGNOSE_CONTROLS_DATA set diagnoseName=?, subTabName=?, classify=? where id=?",updateFileData:"UPDATE DIAGNOSE_CONTROLS_DATA set tabIndex=?, subTabIndex=?, diagnoseName=?, subTabName=?, diagnoseControlFile=?, diagnoseControlFileContent=?, classify=? where id=?",dropTable:"DROP TABLE DIAGNOSE_CONTROLS_DATA"}},clientAppointmentsData:{tableName:"CLIENT_APPOINTMENTS_DATA",queries:{createTable:"CREATE TABLE IF NOT EXISTS CLIENT_APPOINTMENTS_DATA (id INTEGER PRIMARY KEY, clientId, date, attended)",selectData:"SELECT * FROM CLIENT_APPOINTMENTS_DATA",selectDataWhere:"SELECT * FROM CLIENT_APPOINTMENTS_DATA WHERE CLIENTID=?",insertData:"INSERT INTO CLIENT_APPOINTMENTS_DATA (clientId, date, attended) VALUES (?, ?, ?)",updateData:"UPDATE CLIENT_APPOINTMENTS_DATA set attended=? where id=?",dropTable:"DROP TABLE CLIENT_APPOINTMENTS_DATA"}}};var d={clientAppointmentsData:{tableName:"CLIENT_APPOINTMENTS_DATA",createTable:{type:"createTable","default":"CREATE TABLE IF NOT EXISTS CLIENT_APPOINTMENTS_DATA (id INTEGER PRIMARY KEY, clientId, date, attended)"},select:{type:"createTable","default":"SELECT * FROM CLIENT_APPOINTMENTS_DATA",all_where_clientid:"SELECT * FROM CLIENT_APPOINTMENTS_DATA WHERE CLIENTID=?"},insert:{type:"insert","default":"INSERT INTO CLIENT_APPOINTMENTS_DATA (clientId, date, attended) VALUES (?, ?, ?)"},update:{type:"update",attended:"UPDATE CLIENT_APPOINTMENTS_DATA set attended=? where id=?"}}};function l(F,E,G){if(E===g){E=[]}B.transaction(function(H){H.executeSql(z(F,"selectData"),[],function(L,K){var J=[];for(var I=0;I<K.rows.length;I++){J[I]=K.rows.item(I)}G.apply(this,[J])},function(I,J){alert("Error:"+J.message)})})}function v(H,G,F,I,E){if(F===g){F=[]}B.transaction(function(J){var K=z(H,G);J.executeSql(K,F,function(P,O){var N=[];for(var M=0;M<O.rows.length;M++){N[M]=O.rows.item(M)}var L={};if(O.rowsAffected>0&&E!=="delete"&&E!="update"){L.insertId=O.insertId}if(N.length>0){L.rows=N}if(I!==g){I.apply(this,[L])}},function(L,M){alert("Error:"+M.message)})})}function x(F){var I=F.tableReference,G=F.queryReference,J=F.queryParametersArray,K=F.callback,E=F.queryType;var H=[];B.transaction(function(L){for(i=0;i<J.length;i++){L.executeSql(C[I][G],J[i],function(P,O){var N=[];for(var M=0;M<O.rows.length;M++){N[M]=O.rows.item(M)}if(O.rowsAffected>0&&E!=="delete"){H.push(O.insertId)}if(N.length>0){results.rows=N}if(K!==g){K.apply(this,[H])}},function(M,N){alert("Error:"+N.message)})}},function(){},function(){})}function k(F){var I=F.tableReference,G=F.queryReference,J=F.queryParametersArray,K=F.callback,E=F.queryType;var H=[];B.transaction(function(L){for(i=0;i<J.length;i++){L.executeSql(z(I,G),J[i],function(O,N){var M=[];if(N.rowsAffected>0&&E!=="delete"){H.push(N.insertId)}if(K!==g){K.apply(this,[H])}},function(M,N){alert("Error:"+N.message)})}},function(){},function(){})}function x(F,E,G){E=E||[];B.transaction(function(H){H.executeSql(F,E,function(J,I){if(G!==g){G.apply(this,[])}},function(I,J){alert("Error:"+J.message)})})}function u(E){return C[E].tableName}function z(E,F){return C[E].queries[F]}function e(E){B.transaction(function(F){F.executeSql(z("clientData","createTable"),[],function(){if(E===g){return}E.apply(this,["Client Table created"])});F.executeSql(z("clientDiagnoseData","createTable"),[],function(){if(E===g){return}E.apply(this,["Client Diagnose Data Table created"])});F.executeSql(z("diagnoseData","createTable"),[],function(){if(E===g){return}E.apply(this,["Diagnose data Table created"])});F.executeSql(z("classification","createTable"),[],function(){if(E===g){return}E.apply(this,["Classification Table created"])});F.executeSql(z("diagnoseClassification","createTable"),[],function(){if(E===g){return}E.apply(this,["Diagnose Classification Data Table created"])});F.executeSql(z("diagnoseControls","createTable"),[],function(){if(E===g){return}E.apply(this,["Diagnose Controls Table created"])});F.executeSql(z("clientAppointmentsData","createTable"),[],function(){if(E===g){return}E.apply(this,["Client Appointments Data Table created"])})})}function r(){B.transaction(function(E){E.executeSql(z("clientData","dropTable"),[],function(){});E.executeSql(z("clientDiagnoseData","dropTable"),[],function(){});E.executeSql(z("diagnoseData","dropTable"),[],function(){});E.executeSql(z("classification","dropTable"),[],function(){});E.executeSql(z("diagnoseControls","dropTable"),[],function(){});E.executeSql(z("diagnoseClassification","dropTable"),[],function(){});E.executeSql(z("clientAppointmentsData","dropTable"),[],function(){})})}function p(E,F){B.transaction(function(G){G.executeSql("DELETE FROM "+E,[],function(){if(F===g){return}F.apply(this,["Table cleared"])})})}function m(){B.transaction(function(E){E.executeSql("SELECT * FROM CLIENT_DATA WHERE name like '%' || ? || '%'",["Paul"],function(I,H){var G=[];for(var F=0;F<H.rows.length;F++){G[F]=H.rows.item(F)}n(G)},function(F,G){alert("Error:"+G.message)})})}function w(E,G){var F="DIAGNOSE_DATA";B.transaction(function(H){H.executeSql("DELETE FROM "+F+" WHERE diagnoseId=?",[E],function(){if(G===g){return}G.apply(this,["Table cleared"])})})}function h(E,F){B.transaction(function(G){G.executeSql("SELECT * FROM DIAGNOSE_DATA WHERE diagnoseId=?",[E],function(K,J){var I=[];for(var H=0;H<J.rows.length;H++){I[H]=J.rows.item(H)}F.apply(this,[I])},function(H,I){alert("Error:"+I.message)})})}function s(G,E,H){var F=[];B.transaction(function(J){var K=null;var I=[];if(E===g||E===null||E===""){K="SELECT "+G.join(", ")+" FROM CLIENT_DATA"}else{K="SELECT "+G.join(", ")+" FROM CLIENT_DATA WHERE name like '%' || ? || '%'";I=[E]}J.executeSql(K,I,function(O,N){var M=[];for(var L=0;L<N.rows.length;L++){M[L]=N.rows.item(L)}H.apply(this,[M])},function(L,M){alert("Error:"+M.message)})});return F}function n(K,J){var E="",G="<table><thead>",F="",I=document.getElementById("data");for(var H=0;H<K.length;H++){F+="<tr>";for(a in K[H]){if(J===g&&H<=0){E+="<th>"+a+"</th>"}F+="<td>"+K[H][a]+"</td>"}F+="</tr>"}G+=E+"</tr></thead><tbody>";G+=F+"</tbody></table>";return G}function t(E,F){for(c in E){A({data:E[c],callback:F})}}function b(F){var E=F.data;B.transaction(function(G){G.executeSql("UPDATE CLIENT_DATA set name=?, age=?, dateHourOfBirth=?, sex=?, address=?, phone=?, email=? where id=?",[E.name,E.age,E.dateHourOfBirth,E.sex,E.address,E.phone,E.email,E.id],function(I,H){if(F.callback===g){return}F.callback.apply(this,["Data update in table"])},function(){console.log("error insert : "+E)})})}function o(G,F,E,H){if(E===g){E=[]}B.transaction(function(I){I.executeSql(z(G,F),E,function(K,J){if(H!==g){H.apply(this,[])}},function(J,K){alert("Error:"+K.message)})})}function A(F){var E=F.data;var G=F.callback;B.transaction(function(H){if(F.checkunique!==g&&F.checkunique===true){H.executeSql("SELECT * FROM CLIENT_DATA WHERE NAME=?  AND AGE=?AND DATEHOUROFBIRTH=?AND SEX=?AND ADDRESS=?AND PHONE=?AND EMAIL=?",[E.name,E.age,E.dateHourOfBirth,E.sex,E.address,E.phone,E.email],function(I){if(I.length<=0){H.executeSql(y.insertClientData,[E.name,E.age,E.dateHourOfBirth,E.sex,E.address,E.phone,E.email],function(K,J){console.log("success insert e : "+K);if(G===g){return}G.apply(this,[J.insertId,"Data Inserted in table"])},function(){console.log("error insert : "+E)})}},function(){console.log("error insert : "+E)})}else{H.executeSql(y.insertClientData,[E.name,E.age,E.dateHourOfBirth,E.sex,E.address,E.phone,E.email],function(J,I){if(G===g){return}G.apply(this,[I.insertId,"Data Inserted in table"])},function(){console.log("error insert : "+E)})}})}function j(E,I,G,H,F,J){B.transaction(function(K){K.executeSql(y.insertDiagnoseData,[E,I,G,H,F],function(){if(J===g){return}J.apply(this,["Data Inserted in table"])},function(L,M){console.log("error insert into diagnose : "+M.message)})})}return q}(jQuery);var FileModule=function(d,e){var b={initialize:c,readFile:a};function c(){}function a(f,g){fr=new FileReader();fr.onload=function(h){if(g===e){return}g.apply(this,[h.target.result])};fr.readAsText(f)}return b}(jQuery);var TabsModule=function(h){var s={resetTabIndex:c,saveHtml:m,getHtml:x,getAllTabsHtml:k,getAllTabSubtabHtml:b,buildTabSubTabData:d,clearTabs:e,getAllTabSubtabData:u,getTabDetails:l,getTabSubtabDetails:v,getSubtabsIdArray:f,getPreviousSubtabsIdArray:function(){return w},removeTab:p};var o=0,a,q=[],g={},t="diagnoseTab",j="diagnoseSubTab",y=[],w=[];function n(){return o++}function c(){o=0}function m(z){a=z}function x(){return a}function k(){var z="";z=h.map(q,function(D,B){var C={properties:{heading:D.tabName,id:t+D.tabIndex}};var A=getHtmlFromTemplate("#tabItemTemplate",C);return A}).join("");z='<div data-role="navbar"><ul>'+z+"</ul></div>";z+=h.map(q,function(B,A){return B.tabContent}).join("");return z}function b(){var z="";w=y;y=[];z=h.map(q,function(E,C){var D={properties:{heading:E.tabName,id:t+E.tabIndex}};var B=getHtmlFromTemplate("#tabItemTemplate",D);return B}).join("");z='<div data-role="navbar"><ul>'+z+"</ul></div>";var A="";h.each(q,function(C,B){if(B.subTabsArray.length>1){var E=B.subTabsArray;var D=h.map(E,function(I,F){var H={properties:{heading:I.subTabName,id:t+I.tabIndex+j+I.subTabIndex}};var G=getHtmlFromTemplate("#tabItemTemplate",H);return G}).join("");A+='<div id="'+t+B.tabIndex+'"><div data-role="navbar"><ul>'+D+"</ul></div>";A+=h.map(E,function(G,F){return'<div id="'+t+G.tabIndex+j+G.subTabIndex+'">'+G.tabContent+"</div>"}).join("");A+="</div>";y.push(t+B.tabIndex)}else{A+='<div id="'+t+B.tabIndex+'">'+B.subTabsArray[0].tabContent+"</div>"}});z+=A;return z}function u(){return q}function f(){return y}function e(){q=[];g={}}function d(B){var E=B.tabIndex,F=B.subTabIndex,P=B.fileName,O=B.fileContent,A=B.tabName,H=B.subTabName,C=B.jsonData,L=B.insertId,K=B.classify;h.each(C.children[0].children,function(S,R){if(R.type==="Content"){allControls=R.children;return false}});var Q=t+E;var G=j+F;var z=P.replace(".json","");controlFileName=Q+G+P;var J=buildHTML({controls:allControls});if(J===""){J="No Content"}var D={properties:{heading:A,id:Q}};var I=g[E];if(I===undefined){I={};I.tabIndex=E;g[E]=I;q.push(I)}if(I.subTabsArray===undefined){I.subTabsArray=[];I.subTabIndexer={}}var M=I.subTabIndexer[F];if(M===undefined){M={};M.insertId=L;M.tabIndex=E;M.subTabIndex=F;I.subTabIndexer[F]=M;I.subTabsArray.push(M)}var N=J;M.classify=K;M.tabContent=N;M.jsonData=C;M.fileName=P;M.subTabName=H;I.tabName=A}function p(z){g[z]=undefined;for(i=0;i<q.length;i++){if(q[i].tabIndex===z){q.splice(i,1)}}}function r(z,A){g[z].subTabIndexer[A]=undefined;for(i=0;i<q[z].subTabsArray.length;i++){if(q[z].subTabsArray[i].tabIndex===z){q[z].subTabsArray.splice(i,1)}}}function l(z){return g[z]}function v(z,A){return g[z].subTabIndexer[A]}return s}(jQuery);var diagnoseTabCount=0;var ClientTabFunctionality=function(x,l){var h={initialize:w,putDiagnoseDetailsForClient:E,makeActive:q,resetTab:u,getHtmlFromDiagnoseList:A,updateDiagnoseList:v,getSelectedClient:function(){return i}};function w(){B=x("#autocomplete");b=x("#diagnoseTabHeader");L=x("#tabs");k=x("#diagnose #diagnoseId");r=x("#diagnose #diagnoseIdForClient");f=x("#clientTabHeader");H=x("#newClientArea");t=x("#client #clientId");o()}var B=null,b=null,L=null,r=null,k=null,f=null,t=null,H=null,C=false,i="";function o(){var M='input[type="text"], input[type="number"], input[type="email"], input[type="datetime-local"], textarea';H.on("keyup",M,function(){s();x(this).addClass("js-control-value-changed")});H.on("change",'select, input[type="datetime-local"]',function(){s();x(this).addClass("js-control-value-changed")});x("#newClientButton").on("click",function(){x("#newClientArea").slideDown();x("#saveClientButton").show().addClass("ui-disabled js-disabled");x("#editClientButton").hide();C=true;m()});x("#saveClientButton").on("click",function(){if(x(this).hasClass("js-disabled")){return}n()});x("#editClientButton").on("click",function(){p("enable");x("#saveClientButton").show().removeClass("ui-disabled js-disabled");x(this).hide()});x("#cancelChangesClientButton").on("click",function(){H.slideUp()});x("#clearSearchButton").on("click",function(){var N=x("#autocomplete");N.html("").listview("refresh").trigger("updatelayout")});x("#fetchAllButton").on("click",function(){y("");i=""});B.on("filterablebeforefilter",function(O,N){var P=x(N.input);y(P.val());i=""});B.on("click",".js-add-new-diagnose-button",function(){a(x(this).data("client-id"))});B.on("click",".js-delete-client-button",function(){var O=x(this).closest(".js-client-list-item");var N=O.data("id");DataModule.execute("clientData","deleteData",[N],function(){O.slideUp(1000,function(){x(this).remove()});m();H.slideUp()},"delete")});B.on("click",".js-edit-diagnose-button",function(){var O=x(this);var P=O.closest(".js-diagnose-item-container");var N=P.data("client-id");var Q=P.data("diagnose-id");k.val(Q);DiagnoseTabFunctionality.loadDiagnoseDataToHtml(N,Q);DataModule.execute("clientDiagnoseData","selectDataWhereId",[Q],function(R){r.val(R.rows[0].diagnoseIdForClient)})});B.on("click",".js-classify-diagnose-button",function(){var P=x(this).closest(".js-diagnose-item-container");var N=P.data("client-id");var Q=P.data("diagnose-id");var O=x("#diagnoseList"+N+Q).data("diagnose-info");ClassifyTabFunctionality.editDiagnoseItemsCategory(N,Q,O);ClassifyTabFunctionality.makeActive()});B.on("click",".js-delete-diagnose-button",function(){var Q=x(this);var O=Q.closest(".js-diagnose-item-container");var N=O.data("client-id");var P=O.data("diagnose-id");d(P,O)});B.on("click",".js-edit-client-button",function(){var N=x(this).data("client-id");C=false;var P=x("#clientSearchItem"+N).data("row-index");H.slideDown("fast");var O=B.data("rows")[P];D(O);p("enable");x("#saveClientButton").show().addClass("ui-disabled js-disabled");x("#editClientButton").hide();x.mobile.silentScroll(0)});B.on("keyup",M,function(){s(x(this).data("client-id"));x(this).addClass("js-control-value-changed")});B.on("change",'select, input[type="datetime-local"]',function(){s(x(this).data("client-id"));x(this).addClass("js-control-value-changed")});B.on("click",".js-add-appointment",function(){var N=x(this).data("client-id");c(N)});B.on("click",".js-edit-appointments",function(){var N=x(this).data("client-id");z(N)});B.on("click",".js-save-appointments",function(){var N=x(this).data("client-id");j(N)})}function c(M,O,N){O=O||x("#appointmentDate"+M).val();N=(N||"false")==="false"?false:true;if(O===""){return}DataModule.execute("clientAppointmentsData","insertData",[M,O,N],function(P){var Q='<input style="" class="js-appointment-status" type="checkbox" data-role="flipswitch" name="flip-checkbox-'+M+'" data-appointment-id="'+P.insertId+'" data-mini="true" data-on-text="Attended"'+(N?" checked ":"")+' data-off-text="Not Attended" data-wrapper-class="custom-size-flipswitch" disabled="disabled">';var R=x('<li> <span href="#" style="width: 60%; display: inline-block;">'+O+"</span> "+Q+" </li>");x("#appointmentsList"+M).append(R).listview("refresh").trigger("updatelayout").find("li input").flipswitch()})}function z(M){if(x("#appointmentsList"+M+" li").length<=0){return}x("#editAppointmentsButton"+M).hide();x('.js-appointment-status[name="flip-checkbox-'+M+'"]').flipswitch("enable");x("#saveAppointmentsButton"+M).show()}function j(M){x('.js-appointment-status[name="flip-checkbox-'+M+'"]').flipswitch("disable").each(function(Q,P){var O=x(P).data("appointment-id");var N=x(P).prop("checked");DataModule.execute("clientAppointmentsData","updateData",[N,O],function(){},"update")});x("#saveAppointmentsButton"+M).hide();x("#editAppointmentsButton"+M).show()}function g(M){DataModule.execute("clientAppointmentsData","selectDataWhere",[M],function(N){if(N.rows===l){return}x.each(N.rows,function(P,O){c(M,O.date,O.attended)})})}function n(){var M=x("#clientId").val();if(C===l||C===false){H.slideUp();x(".js-control-value-changed").each(function(N,O){x("#"+x(O).attr("id")+M).html(x(O).val()).data("current-value");x(O).removeClass("js-control-value-changed")})}K({id:M,name:x("#clientNameInput").val(),age:x("#clientAgeInput").val(),dateHourOfBirth:x("#birthdateAndHourInput").val(),sex:x("#clientGender").val(),address:x("#clientAddressInput").val(),phone:x("#clientPhoneInput").val(),email:x("#clientEmailInput").val()},function(N){x("#clientId").val(N)});p("disable");DataModule.execute("clientData","selectDataWhere",[M],function(N){var O=N.rows;B.data("rows",O)});x("#saveClientButton").hide();x("#editClientButton").show()}function d(N,M){DataModule.execute("diagnoseData","selectDataWhere",[N],function(P){var O=P.rows;if(O!==l){x.each(O,function(Q,R){DataModule.execute("diagnoseClassification","deleteDataWhere",[R.id],function(){},"delete")})}DataModule.execute("diagnoseData","deleteData",[N],function(){DataModule.execute("clientDiagnoseData","deleteData",[N],function(){M.slideUp(1000,function(){x(this).remove()})},"delete")},"delete")})}function q(){L.tabs("option","active",0);x("#mainTabHeader",L).find(".ui-btn-active").removeClass("ui-btn-active");f.addClass("ui-btn-active").removeClass("ui-disabled")}function G(){f.removeClass("ui-btn-active");f.addClass("ui-disabled")}function u(){m();B.html("")}function a(M){DataModule.execute("clientDiagnoseData","getCountWhere",[M],function(N){r.val(N.rows[0]["COUNT(1)"]+1)});DiagnoseTabFunctionality.makeActive();DiagnoseTabFunctionality.resetForm();DiagnoseTabFunctionality.setDiagnoseClientId(M)}function K(N,O){var M=N.id;if(M===""){DataModule.insertClientData({data:N,callback:function(P,Q){O.apply(this,[P])}})}else{DataModule.updateClientData({data:N,callback:function(Q,P){}})}}function p(N,M){if(M===l){M=""}x("#clientNameInput"+M).textinput(N);x("#clientAgeInput"+M).textinput(N);x("#birthdateAndHourInput"+M).textinput(N);x("#clientGender"+M).selectmenu("refresh").selectmenu(N);x("#clientAddressInput"+M).textinput(N);x("#clientPhoneInput"+M).textinput(N);x("#clientEmailInput"+M).textinput(N)}function s(M){if(M===l){M=""}x("#saveClientButton"+M).removeClass("ui-disabled js-disabled")}function m(){x("#clientId").val("");x("#clientNameInput").val("").textinput("enable");x("#clientAgeInput").val("").textinput("enable");x("#birthdateAndHourInput").val("").textinput("enable");x("#clientGender").val("").selectmenu("refresh").selectmenu("enable");x("#clientAddressInput").val("").textinput("enable");x("#clientPhoneInput").val("").textinput("enable");x("#clientEmailInput").val("").textinput("enable")}function D(M){x("#clientId").val(M.id).data("current-value",M.id);x("#clientNameInput").val(M.name).data("current-value",M.name);x("#clientAgeInput").val(M.age).data("current-value",M.age);x("#birthdateAndHourInput").val(M.dateHourOfBirth).data("current-value",M.dateHourOfBirth);x("#clientGender").val(M.sex).selectmenu("refresh").data("current-value",M.sex);x("#clientAddressInput").val(M.address).data("current-value",M.address);x("#clientPhoneInput").val(M.phone).data("current-value",M.phone);x("#clientEmailInput").val(M.email).data("current-value",M.email)}function y(M){DataModule.getColumnData(["*"],M,function(N){B.html(x.map(N,function(Q,P){var O=getHtmlFromTemplate("#collapsiblePanelForClientTemplate",{properties:{heading:Q.name,clientId:Q.id,personalData:[Q]}});return'<li id="clientSearchItem'+Q.id+'" class="js-client-list-item" data-id="'+Q.id+'" data-row-index="'+P+'"> '+O+" </li>"}).join(""));B.data("rows",N).listview("refresh").trigger("updatelayout");e();x("#defaultPage").enhanceWithin()})}function e(){x(".js-client-details",B).data("details-populated",false).collapsible().collapsible({expand:function(O,P){var N=x(this);x("li",B).not(N.closest(".js-client-list-item")).remove();var R=N.closest("li.js-client-list-item").data("row-index");var Q=B.data("rows")[R];if(N.data("details-populated")===true){return}var M=N.data("client-id");i=M;F(M);DataModule.execute("clientDiagnoseData","selectDataWhere",[M],function(S){var T=S.rows;if(T===l){return}var U=x.map(T,function(X,W){var V=J(X.id,X.diagnoseName,X.clientId);return V}).join("");N.data("details-populated",true).find(".js-diagnose-details").append(U);x.each(T,function(V,W){DataModule.execute("diagnoseData","selectDataWhere",[W.id],function(aa){var Y=aa.rows;if(Y===l){return}x.each(Y,function(ad,ae){ae.diagnoseItemId=ae.id});var Z=A(Y);var X=x("#diagnoseList"+M+W.id);X.data("diagnose-info",Y).data("client-id",M);X.append(Z).listview("refresh").trigger("updatelayout");var ac={};var ab={};I(M,W.id,Y,ac,ab)});x("#defaultPage").enhanceWithin()});x("#defaultPage").enhanceWithin()})}})}function F(M){g(M)}function E(M,P,U,S,T,R,N){var Q=x(".js-diagnose-details",x('.js-client-details[data-client-id="'+M+'"]'));if(T==true){var O=J(P,U,M);Q.append(O).collapsibleset().collapsibleset("refresh")}x("#diagnoseList"+M+P).data("diagnose-info",S).data("client-id",M).html("").append(A(S)).listview().listview("refresh").trigger("updatelayout");I(M,P,S,R,N);FunctionalityModule.enhancePage()}function I(M,Q,N,P,O){if(P===l){P={}}if(O===l){O={}}x.each(N,function(S,T){var R=T.id||T.diagnoseItemId;P[R]=T.controlLabel+" : "+T.controlValueLabel;DataModule.execute("diagnoseClassification","selectDataWhere",[R],function(U){var V=U.rows;if(V!==l){x.each(V,function(W,Z){var Y=Z.classificationId;var X=FunctionalityModule.getClassificationAtId(Y).name;if(O[Y]===l){O[Y]={className:X,diagnoseItems:[]}}O[Y].diagnoseItems.push({id:R,name:T.controlLabel+" : "+T.controlValueLabel})});delete P[R]}if(S===N.length-1){v(M,Q,O,P)}})})}function v(N,S,P,R){var Q={};x.each(P,function(T,U){if(Q[T]===l){Q[T]=[];Q[T].push('<li  data-role="list-divider" style="font-weight:bold">'+U.className+"</li>")}x.each(U.diagnoseItems,function(V,W){Q[T].push("<li>"+W.name+"</li>");delete R[W.id]})});var M=x("#diagnoseList"+N+S);M.html(x.map(Q,function(U,T){return U.join("")}).join(""));var O=false;x.each(R,function(T,U){if(!O){M.append('<li data-role="list-divider" style="font-weight: bold">Unclassified</li>');O=true}M.append("<li>"+U+"</li>")});M.listview().listview("refresh").trigger("updatelayout");FunctionalityModule.enhancePage()}function J(P,O,N){var M=getHtmlFromTemplate("#collapsiblePanelForClientDiagnoseTemplate",{properties:{heading:O,clientId:N,id:P,uniqueDiagnoseListId:"diagnoseList"+N+P,classes:FunctionalityModule.getClassificationCount()>0?"js-classify-diagnose-button":"js-classify-diagnose-button ui-disabled"}});return M}function A(M){return x.map(M,function(O,N){var P='<li data-diagnose-item-id="'+O.diagnoseItemId+'" data-diagnose-id="'+O.diagnoseId+'">'+O.controlLabel+" : "+O.controlValueLabel+"</li>";return P}).join("")}return h}(jQuery);var DiagnoseTabFunctionality=function(e,g){var k={initialize:x,resetForm:u,populateDiagnoseControlValues:n,makeActive:p,loadDiagnoseDataToHtml:r,buildAllDiagnoseTabs:j,setDiagnoseClientId:q,clearDiagnoseTabs:b,addContainerToDiagnoseTabArea:l};var h=null,o=null,s=true,w=null,y=null,m=null,t=null,i=null,c=null,a=false,d=0;function x(){h=e("#diagnoseTabArea");o=e("#defaultPage");t=e("#diagnoseId");i=e("#diagnoseIdForClient");y=e("#diagnoseTabHeader");w=e("#clientTabHeader");m=e("#tabs");c=e("#diagnose #clientId");j(true);if(diagnoseTabCount>0){e("#diagnoseTabArea").tabs()}z()}function z(){e("#saveDiagnoseChanges").on("click",function(){f();ClientTabFunctionality.makeActive()});e("#cancelDiagnoseChanges").on("click",function(){u()})}function q(A){c.val(A)}function f(){var A=c.val();if(A===""){alert("Please select a client first");return}var B="Diagnose: "+i.val()+", "+(new Date()).toLocaleString();if(s==false){DataModule.deleteDiagnoseData(A)}e("#diagnoseUnclassified ul").html("");if(s==true){DataModule.execute("clientDiagnoseData","insertData",[A,i.val(),B,(new Date()).toDateString()],function(D){var E=D.insertId;v(A,E,B,s)})}else{var C=t.val();v(A,C,B,s)}}function v(A,G,D,C){var B=n(G);var F=[];e.each(B,function(I,H){F.push(H.toInsert)});var E={};E.tableReference="diagnoseData";E.queryReference="insertData";E.queryParametersArray=F;E.callback=function(K){if(K.length<B.length){return}var H=[];var J={};var I={};e.each(B,function(L,M){M.diagnoseDetail.diagnoseItemId=K[L];H.push(M.diagnoseDetail)});ClientTabFunctionality.putDiagnoseDetailsForClient(A,G,D,H,C,J,I)};E.queryType="insert";DataModule.executeAll(E)}function p(){m.tabs("option","active",1);e("#mainTabHeader",m).find(".ui-btn-active").removeClass("ui-btn-active");y.addClass("ui-btn-active").removeClass("ui-disabled")}function u(){s=true;e("[data-save-control]").each(function(B,A){var C=e(A).attr("data-save-control");switch(C){case"checkbox":case"radio":e(":checked",e(A)).each(function(D,E){e(E).prop("checked",false)});break;case"toggleSwitch":e('input[type="checkbox"]',e(A)).each(function(D,E){e(E).prop("checked",false).flipswitch("refresh")});break;case"slider":e("input",e(A)).each(function(D,E){e(E).val(e(E).attr("data-default-value")).slider("refresh")});break;case"TextInput":e("input",e(A)).each(function(D,E){e(E).val("").textinput("refresh")});break;default:e("input",e(A)).each(function(D,E){e(E).val("")});break}});o.enhanceWithin()}function r(A,B){q(A);u();s=false;DataModule.execute("diagnoseData","selectDataWhere",[B],function(C){p();var D=C.rows;if(D===g){return}e.each(D,function(E,G){console.log(G);var F=e("#"+G.controlId);switch(G.controlType){case"toggleSwitch":F.prop("checked",G.controlValue==="on"?true:false).flipswitch("refresh");break;case"slider":F.val(G.controlValue).slider("refresh");break;case"checkbox":case"radio":F.prop("checked",G.controlValue).checkboxradio("refresh");break;default:F.val(G.controlValue);break}});o.enhanceWithin()})}function n(B){var A=[];e("[data-save-control]").each(function(C,D){switch(e(D).attr("data-save-control")){case"slider":e('input[type="number"]',e(D)).each(function(E,F){if(e(F).val()===e(F).attr("data-default-value")){return}A.push({toInsert:[B,e(F).attr("id"),e(F).attr("data-save-label"),e(D).attr("data-save-control"),e(F).val(),e(F).val()],diagnoseDetail:{diagnoseId:B,controlLabel:e(F).attr("data-save-label"),controlValueLabel:e(F).val(),controlValue:e(F).val()}})});break;case"checkbox":case"radio":e(":checked",e(D)).each(function(E,F){A.push({toInsert:[B,e(F).attr("data-save-id"),e(F).attr("data-save-label"),e(D).attr("data-save-control"),e(F).val(),e(F).prop("checked")],diagnoseDetail:{diagnoseId:B,controlLabel:e(F).attr("data-save-label"),controlValueLabel:e(F).val(),controlValue:e(F).val()}})});break;case"toggleSwitch":e(":checked",e(D)).each(function(E,F){A.push({toInsert:[B,e(F).attr("id"),e(F).attr("data-save-label"),e(D).attr("data-save-control"),e(F).val()==="off"?e(F).attr("data-save-attr-label1"):e(F).attr("data-save-attr-label2"),e(F).val()],diagnoseDetail:{diagnoseId:B,controlLabel:e(F).attr("data-save-label"),controlValueLabel:e(F).val()==="off"?e(F).attr("data-save-attr-label1"):e(F).attr("data-save-attr-label2"),controlValue:e(F).val()}})});break;case"TextInput":e('input[type="text"]',e(D)).each(function(E,F){if(e(this).val()===""){return}A.push({toInsert:[B,e(F).attr("id"),e(F).attr("data-save-label"),e(D).attr("data-save-control"),e(F).val()==="off"?e(F).attr("data-save-attr-label1"):e(F).attr("data-save-attr-label2"),e(F).val()],diagnoseDetail:{diagnoseId:B,controlLabel:e(F).attr("data-save-label"),controlValueLabel:e(F).val()==="off"?e(F).attr("data-save-attr-label1"):e(F).attr("data-save-attr-label2"),controlValue:e(F).val()}})});break;default:break}});return A}function j(A){DataModule.execute("diagnoseControls","selectData",[],function(C){var D=C.rows;if(D===g){return}TabsModule.clearTabs();e.each(D,function(G,H){var F=H.id;var E={tabName:H.diagnoseName,subTabName:H.subTabName,tabIndex:H.tabIndex,subTabIndex:H.subTabIndex,insertId:H.id,fileName:H.diagnoseControlFile,fileContent:H.diagnoseControlFileContent,jsonData:JSON.parse(H.diagnoseControlFileContent),classify:H.classify==="true"?true:false};TabsModule.buildTabSubTabData(E)});var B=TabsModule.getAllTabSubtabData();if(A===g||A===true){e.each(B,function(F,E){AddDiagnoseFromJsonFunctionality.addDiagnoseTabConfig(E)})}b();l()})}function l(){h.html(TabsModule.getAllTabSubtabHtml());FunctionalityModule.enhancePage();h.tabs().tabs("option","active",0);e.each(TabsModule.getSubtabsIdArray(),function(A,B){e("#"+B).tabs().tabs("option","active",0);e("#"+B+' > [data-role="navbar"] a:first').addClass("ui-btn-active")});a=true}function b(){e.each(TabsModule.getPreviousSubtabsIdArray(),function(B,A){e("#"+A).tabs("destroy")});if(a===true){h.tabs("destroy");a=false}h.html("");FunctionalityModule.enhancePage();diagnoseTabCount=0;d=0}return k}(jQuery);var ClassifyTabFunctionality=function(e,c){var n={initialize:f,makeActive:j,editDiagnoseItemsCategory:g};var d=null,h=null,l=null,k=null;function f(){d=e("#classificationTabHeader");h=e("#tabs");l=e("#classification");k=e("#classificationTabContent");_$editClassificationList=e("#editClassificationList");b()}function b(){e("#saveClassificationChanges").on("click",function(){m()})}function m(){var p={};var q={};var o="";var r="";e(".js-diagnose-list-item",_$editClassificationList).each(function(t,u){var x=e(u);o=x.data("client-id");r=x.data("diagnose-id");var s=x.data("diagnose-item-id");var w=x.data("diagnose-item-name");var v=e("#diagnoseList"+o+r).find('li[data-diagnose-item-id="'+s+'"]');q[s]=w;e(".js-diagnose-classification-item:checked",x).each(function(y,B){var A=e(B).data("class-id");var z=e(B).data("class-name");if(p[A]===c){p[A]={className:z,diagnoseItems:[]}}p[A].diagnoseItems.push({id:s,name:w})});DataModule.execute("diagnoseClassification","deleteDataWhere",[s],function(){e(".js-diagnose-classification-item:checked",x).each(function(y,A){var z=e(A).data("class-id");DataModule.execute("diagnoseClassification","insertData",[s,z],function(){})})},"delete")});ClientTabFunctionality.updateDiagnoseList(o,r,p,q);ClientTabFunctionality.makeActive();i()}function j(){h.tabs("option","active",2);e("#mainTabHeader",h).find(".ui-btn-active").removeClass("ui-btn-active");d.addClass("ui-btn-active").removeClass("ui-disabled")}function i(){d.removeClass("ui-btn-active").addClass("ui-disabled")}function g(o,r,p){e.each(p,function(s,t){t.id=t.diagnoseItemId});var q=a(o,p);_$editClassificationList.html("").append(q);e.each(p,function(s,t){DataModule.execute("diagnoseClassification","selectDataWhere",[t.id],function(u){var v=u.rows;if(v===c){return}e.each(v,function(w,y){var x=e('[data-diagnose-item-id="'+t.id+'"]');e(".js-diagnose-classification-item[data-class-id="+y.classificationId+"]",x).prop("checked",true);_$editClassificationList.find(".js-diagnose-list-item").collapsible().collapsible("refresh").trigger("updatelayout");_$editClassificationList.find(".js-diagnose-classification-item").checkboxradio().checkboxradio("refresh");FunctionalityModule.enhancePage()})})});_$editClassificationList.find(".js-diagnose-list-item").collapsible().collapsible("refresh").trigger("updatelayout");_$editClassificationList.find(".js-diagnose-classification-item").checkboxradio().checkboxradio("refresh");FunctionalityModule.enhancePage()}function a(o,p){return e.map(p,function(s,r){var q={properties:{heading:s.controlLabel+" : "+s.controlValueLabel,diagnoseId:s.diagnoseId,diagnoseItemId:s.id,clientId:o,children:FunctionalityModule.getAllClassificationName()}};var t=getHtmlFromTemplate("#collapsibleListItemInClientDiagnoseTemplate",q);return t}).join("")}return n}(jQuery);var ConfigTabFunctionality=function(e,f){var j={initialize:v,resetForm:u};function v(){t();q()}var l=null,k=null,c=null,n='<a class="js-delete-classification ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-inline" data-iconpos="right">Button</a>';function t(){l=e("#diagnoseConfig");k=e("#allClassificationNames");c=e("#classificationName");AddDiagnoseFromJsonFunctionality.initialize();g()}function g(){DataModule.execute("classification","selectData",[],function(x){var y=x.rows;if(y===f){return}e.each(y,function(z,A){a(A.id,A.classificationName)});k.listview("refresh").trigger("updatelayout");FunctionalityModule.enhancePage()})}function q(){e("#dropDBStructureButton").on("click",function(){DataModule.dropAllTables();u();ClientTabFunctionality.resetTab()});e("#addClassificationButton").on("click",function(){d()});e("#loadTestClientDataButton").on("click",function(){DataModule.insertTestData(clientList,o)});e("#createDBButton").on("click",function(){DataModule.createAllTables(o)});k.on("click",".js-delete-classification",function(){var x=e(this).data("dat-id");DataModule.execute("classification","deleteData",[x],function(){e("#classificationItem"+x).slideUp(300,function(){e(this).remove()})},"delete")});e("#dbExportDataButton").on("click",function(){var x=r()})}function a(A,x){FunctionalityModule.addClassificationName(A,x);var z=e(n).data("dat-id",A);var y=e('<li id="classificationItem'+A+'" style="display:none"><a href="#">'+x+"</a></li>").append(z);k.append(y.slideDown(300))}function s(y,x){if(x){y+=1462}var z=Date.parse(y);return(z-new Date(Date.UTC(1899,11,30)))/(24*60*60*1000)}function h(E,D){var y={};var z={s:{c:10000000,r:10000000},e:{c:0,r:0}};for(var B=0;B!=E.length;++B){for(var F=0;F!=E[B].length;++F){if(z.s.r>B){z.s.r=B}if(z.s.c>F){z.s.c=F}if(z.e.r<B){z.e.r=B}if(z.e.c<F){z.e.c=F}var x={v:E[B][F]};if(x.v==null){continue}var A=XLSX.utils.encode_cell({c:F,r:B});if(typeof x.v==="number"){x.t="n"}else{if(typeof x.v==="boolean"){x.t="b"}else{if(x.v instanceof Date){x.t="n";x.z=XLSX.SSF._table[14];x.v=s(x.v)}else{x.t="s"}}}y[A]=x}}if(z.s.c<10000000){y["!ref"]=XLSX.utils.encode_range(z)}return y}var w=[[1,2,3],[true,false,null,"sheetjs"],["foo","bar",new Date("2014-02-19T14:30Z"),"0.3"],["baz",null,"qux"]];var i="SheetJS";function p(){if(!(this instanceof p)){return new p()}this.SheetNames=[];this.Sheets={}}function m(A){var y=new ArrayBuffer(A.length);var x=new Uint8Array(y);for(var z=0;z!=A.length;++z){x[z]=A.charCodeAt(z)&255}return y}function r(){DataModule.execute("clientData","selectData",[],function(D){var H={"ClientData.csv":{data:"Client Id, Client Name\n",type:"text/csv"}};var z=new p();var y="ClientData.csv";var A=D.rows;var G={};var F={s:{c:10000000,r:10000000},e:{c:0,r:0}};for(var B=0;B!=A.length;++B){var x=0;e.each(A[B],function(I,K){if(F.s.r>B){F.s.r=B}if(F.s.c>x){F.s.c=x}if(F.e.r<B){F.e.r=B}if(F.e.c<x){F.e.c=x}var C={v:A[B][I]};if(C.v==null){return}var J=XLSX.utils.encode_cell({c:x,r:B});if(typeof C.v==="number"){C.t="n"}else{if(typeof C.v==="boolean"){C.t="b"}else{if(C.v instanceof Date){C.t="n";C.z=XLSX.SSF._table[14];C.v=s(C.v)}else{C.t="s"}}}G[J]=C;x++})}if(F.s.c<10000000){G["!ref"]=XLSX.utils.encode_range(F)}z.SheetNames.push(i);z.Sheets[i]=G;var E=XLSX.write(z,{bookType:"xlsx",bookSST:true,type:"binary"});saveAs(new Blob([m(E)],{type:"application/octet-stream"}),"ClientData.xlsx");return G})}function b(){DataModule.execute("clientData","selectData",[],function(C){var z={"ClientData.csv":{data:"Client Id, Client Name\n",type:"text/csv"}};var y="ClientData.csv";var B=",";e.each(C.rows,function(F,G){var H="";H+=G.id;H+=B;H+=G.name;H+=B;H+=G.age;H+=B;H+=G.dateHourOfBirth;H+=B;H+=G.sex;H+=B;H+=G.address.replace("\n","").replace(","," ");H+=B;H+=G.phone;H+=B;H+=G.email;H+="\n";z[y].data+=H});var A=new File([z[y].data],y,{type:z[y].type,lastModified:Date.now()});var x=URL.createObjectURL(A,{oneTimeOnly:true});var D=document.createElement("a");D.href=x;D.download=y;D.textContent=y;var E=document.createElement("li");E.appendChild(D);e("#dbSection #filesForDownload").append(E)})}function d(){if(c.val()===""){return}DataModule.execute("classification","insertData",[c.val()],function(x){a(x.insertId,c.val());k.listview("refresh").trigger("updatelayout");FunctionalityModule.enhancePage();c.val("");e(".js-classify-diagnose-button").removeClass("ui-disabled")})}function u(){e("ul",l).html("");k.html("")}function o(x){e("#configEventsMessages").show().find("ul").append('<li class="ui-icon-home">'+x+"</li>").listview("refresh").trigger("updatelayout");setTimeout(function(){e("#configEventsMessages").fadeOut(1000,function(){e(this).find("ul").html("")})},2000)}return j}(jQuery);var ClassifyTabFunctionality=function(e,c){var n={initialize:f,makeActive:j,editDiagnoseItemsCategory:g};var d=null,h=null,l=null,k=null;function f(){d=e("#classificationTabHeader");h=e("#tabs");l=e("#classification");k=e("#classificationTabContent");_$editClassificationList=e("#editClassificationList");b()}function b(){e("#saveClassificationChanges").on("click",function(){m()})}function m(){var p={};var q={};var o="";var r="";e(".js-diagnose-list-item",_$editClassificationList).each(function(t,u){var x=e(u);o=x.data("client-id");r=x.data("diagnose-id");var s=x.data("diagnose-item-id");var w=x.data("diagnose-item-name");var v=e("#diagnoseList"+o+r).find('li[data-diagnose-item-id="'+s+'"]');q[s]=w;e(".js-diagnose-classification-item:checked",x).each(function(y,B){var A=e(B).data("class-id");var z=e(B).data("class-name");if(p[A]===c){p[A]={className:z,diagnoseItems:[]}}p[A].diagnoseItems.push({id:s,name:w})});DataModule.execute("diagnoseClassification","deleteDataWhere",[s],function(){e(".js-diagnose-classification-item:checked",x).each(function(y,A){var z=e(A).data("class-id");DataModule.execute("diagnoseClassification","insertData",[s,z],function(){})})},"delete")});ClientTabFunctionality.updateDiagnoseList(o,r,p,q);ClientTabFunctionality.makeActive();i()}function j(){h.tabs("option","active",2);e("#mainTabHeader",h).find(".ui-btn-active").removeClass("ui-btn-active");d.addClass("ui-btn-active").removeClass("ui-disabled")}function i(){d.removeClass("ui-btn-active").addClass("ui-disabled")}function g(o,r,p){e.each(p,function(s,t){t.id=t.diagnoseItemId});var q=a(o,p);_$editClassificationList.html("").append(q);e.each(p,function(s,t){DataModule.execute("diagnoseClassification","selectDataWhere",[t.id],function(u){var v=u.rows;if(v===c){return}e.each(v,function(w,y){var x=e('[data-diagnose-item-id="'+t.id+'"]');e(".js-diagnose-classification-item[data-class-id="+y.classificationId+"]",x).prop("checked",true);_$editClassificationList.find(".js-diagnose-list-item").collapsible().collapsible("refresh").trigger("updatelayout");_$editClassificationList.find(".js-diagnose-classification-item").checkboxradio().checkboxradio("refresh");FunctionalityModule.enhancePage()})})});_$editClassificationList.find(".js-diagnose-list-item").collapsible().collapsible("refresh").trigger("updatelayout");_$editClassificationList.find(".js-diagnose-classification-item").checkboxradio().checkboxradio("refresh");FunctionalityModule.enhancePage()}function a(o,p){return e.map(p,function(s,r){var q={properties:{heading:s.controlLabel+" : "+s.controlValueLabel,diagnoseId:s.diagnoseId,diagnoseItemId:s.id,clientId:o,children:FunctionalityModule.getAllClassificationName()}};var t=getHtmlFromTemplate("#collapsibleListItemInClientDiagnoseTemplate",q);return t}).join("")}return n}(jQuery);var AddDiagnoseFromJsonFunctionality=function(d,b){var n={initialize:e,addDiagnoseTabConfig:m};var f=null,k=-1,c=[];function e(){h();a()}function h(){f=d("#diagnoseConfig")}function a(){f.on("click",".js-save-button",function(){var r=d(this).closest(".js-new-diagnose-container");var q=r.data("diagnose-tab-config-index");var p=r.find(".js-diagnose-name").val();j(q,p)});f.on("change",".js-diagnose-file",function(t){var s=d(this);var q=s[0].files[0];if(q!==b){var v=s[0].files[0].name;var p=s.data("diagnose-tab-config-index");var r=s.data("diagnose-tab-subtabfile-index");var u='.js-diagnose-file-name[data-diagnose-tab-config-index="'+p+'"][data-diagnose-tab-subtabfile-index="'+r+'"]';if(d(u).val()===""){d(u).val(v.replace(".json",""))}}});f.on("click",".js-delete-button",function(){var r=ClientTabFunctionality.getSelectedClient();var q=d(this);var p=q.data("diagnose-tab-config-index");DataModule.execute("diagnoseControls","selectDataWhere",[p],function(s){var t=s.rows;if(t===b){return}d.each(t,function(u,v){DataModule.execute("diagnoseData","deleteDataWhere",["diagnoseTab"+v.tabIndex+"diagnoseSubTab"+v.subTabIndex],function(){})})});DataModule.executeQuery("DELETE FROM DIAGNOSE_CONTROLS_DATA WHERE tabIndex=?",[p],function(){q.closest(".js-tab-details-container").slideUp(1000,function(){d(this).remove()});if(r!==""){DiagnoseTabFunctionality.populateDiagnoseControlValues(r)}DiagnoseTabFunctionality.clearDiagnoseTabs();DiagnoseTabFunctionality.buildAllDiagnoseTabs(false)})});f.on("click",".js-add-subtab-button",function(){var p=d(this).data("diagnose-tab-config-index");i(p)});d("#addDiagnoseTabButton").on("click",function(){m()})}function m(q){if(q===b){q={tabIndex:++k};var p=[{tabIndex:q.tabIndex,subTabIndex:0,isNewDiagnoseFile:true}];q.subTabsArray=p}else{k=q.tabIndex}if(c[q.tabIndex]===b){c[q.tabIndex]=[];d.each(q.subTabsArray,function(r,s){if(c[q.tabIndex].indexOf(s.subTabIndex)===-1){c[q.tabIndex].push(s.subTabIndex)}})}d("#diagnoseConfig ul").append(getHtmlFromTemplate("#configEntryItemTemplate",q));FunctionalityModule.enhancePage();d.each(q.subTabsArray,function(s,u){var r='[data-diagnose-tab-config-index="'+u.tabIndex+'"][data-diagnose-tab-subtabfile-index="'+u.subTabIndex+'"]';var t=".categorize-subtab-flipswitch"+r;d(t).prop("checked",u.classify).flipswitch("refresh")})}function i(q){d("#newDiagnoseContainer"+q).data("has-subtabs",true);var s=c[q];var p=Math.max.apply(null,s);p++;s.push(p);var r=getHtmlFromTemplate("#configEntryFileInputTemplate",{tabIndex:q,subTabIndex:p,isNewDiagnoseFile:true});d("#diagnoseControlsFilesContainer"+q).append(r);FunctionalityModule.enhancePage()}function j(q,p){d.each(c[q],function(r,s){o(q,p,s)})}function o(A,C,u){var B='[data-diagnose-tab-config-index="'+A+'"][data-diagnose-tab-subtabfile-index="'+u+'"]';var q='.js-diagnose-file[type="file"]'+B;var s=d(q)[0].files[0];var z=".categorize-subtab-flipswitch"+B;var y=d(z).prop("checked");var r=".js-subtab"+B;var x=d(r),p=x.data("insert-id");var p=x.data("insert-id");var t=".js-diagnose-file-name"+B;var v=d(t).val();var w=x.data("is-new-diagnose-file");if(p!==b&&p!==""&&s===b){l(A,u,C,v,y,p)}if(s===b){return}FileModule.readFile(s,function(D){if(w){DataModule.execute("diagnoseControls","insertData",[A,u,C,v,s.name,D,y],function(F){var E=F.insertId;x.data("insert-id",E);g({diagnoseSectionName:C,subTabName:v,tabIndex:A,insertId:E,subTabIndex:u,action:"insert",fileName:s.name,fileContent:D,classify:y})})}else{DataModule.execute("diagnoseControls","updateFileData",[A,u,C,v,s.name,D,y,p],function(E){g({diagnoseSectionName:C,subTabName:v,tabIndex:A,insertId:p,subTabIndex:u,action:"update",fileName:s.name,fileContent:D,classify:y})},"update")}});if(w===true){x.data("is-new-diagnose-file",false)}}function l(q,u,p,r,t,s){DataModule.execute("diagnoseControls","updateData",[p,r,t,s],function(){g({diagnoseSectionName:p,subTabName:r,tabIndex:q,subTabIndex:u,classify:t,action:"update"})},"update")}function g(C){var B=C.diagnoseSectionName,v=C.subTabName,q=C.tabIndex,s=C.action,p=C.insertId,u=C.subTabIndex,r=C.fileContent,t=C.fileName,z=C.classify;var A=null;if(s==="update"){var y=TabsModule.getTabDetails(q);var x=TabsModule.getTabSubtabDetails(q,u);y.tabName=B;if(t!==b&&t!==""){x.fileName=t}else{if(t===b||t===""){t=x.fileName}}if(r===b){A=x.jsonData}else{A=JSON.parse(r);x.jsonData=A}}if(s==="insert"){if(r!==b){A=JSON.parse(r)}}var w={tabName:B,subTabName:v,tabIndex:q,subTabIndex:u,insertId:p,fileName:t,fileContent:r,jsonData:A,classify:z};TabsModule.buildTabSubTabData(w);DiagnoseTabFunctionality.clearDiagnoseTabs();DiagnoseTabFunctionality.addContainerToDiagnoseTabArea()}return n}(jQuery);var FunctionalityModule=function(e,i,p,c,l,f){var n={initialize:x,enhancePage:k,addClassificationName:b,getClassificationNameAt:d,getAllClassificationName:t,getClassificationCount:m,getClassificationAtId:q};var y=null,o=null,r=null,s=null,h="<li><a href='#{href}'>#{label}</a></li>",g=0,j=[],u={};function x(){e.each(tabsControls.children,function(z,A){if(e('[href="#'+A.properties.id+'"]').length<=0){tabControlsToAdd.children.push(A)}});e('#tabs [data-role="navbar"] ul').append(getHtmlFromTemplate("#tabItemTemplate",tabControlsToAdd.children));$mainTabContainer=e("#diagnoseTabArea");e("#defaultPage").enhanceWithin();e("#tabs").tabs();p.initialize();p.createAllTables();r=e("#defaultPage");y=e("#classificationTabs");s=y.html();g=y.find("#tabHeader li").length;y.tabs();i.initialize();ClassifyTabFunctionality.initialize();DiagnoseTabFunctionality.initialize();ConfigTabFunctionality.initialize();v()}function k(){r.enhanceWithin()}function w(C){y.tabs("destroy");y.html(s);var B=C||"Tab "+g,D="tabs-"+g,z=e(h.replace(/#\{href\}/g,"#"+D).replace(/#\{label\}/g,B)),A="<ul id='"+D+"' class='tablist-content' data-role='listview' data-inset='true'>No diagnose items in "+B+"</li>";y.find(".ui-tabs-nav").append(z);y.append(A);s=y.html();y.tabs().tabs("refresh").tabs("option","active",g);g++}function v(){e("#diagnoseTabArea").on("change","input",function(){var z=e("#clientId").val();if(z!==""){e("#saveDiagnoseChanges").removeClass("ui-disabled")}})}function a(z,A){p.getDiagnoseList(z,A)}function b(B,z){var A={id:B,name:z};j.push(A);u[B]=A}function d(z){return j[z]}function q(z){return u[z]}function t(){return j}function m(){return j.length}return n}(jQuery,ClientTabFunctionality,DataModule,FileModule,TabsModule);var controlFileName="";var templateItemCount=0;var firstId="";var toggleSwitchCounter=0;$.addTemplateFormatter({prependChars:function(b,a){return a+b},controlType:function(b,a){switch(b){case"TextInput":return"text";case"datetime-local":return"datetime-local";default:return"text"}},getUniqueProperty:function(d,c){if(d===undefined&&c==="toggleSwitch"){toggleSwitchCounter++;for(i=toggleSwitchCounter;i<200;i++){if($("#toggleSwitch"+i).length<=0){toggleSwitchCounter=i;break}}d=c+toggleSwitchCounter}var a=controlFileName.split("/");var b=a[a.length-1];b=b.replace(".","");return b+d},getFirstName:function(a){if(templateItemCount===0){firstId=a}templateItemCount++;return firstId}});var defaultTabsControls={children:[{type:"tab",properties:{heading:"Diagnose",id:"diagnose",appendToId:"diagnoseTabArea"},controlsFiles:[],tabType:"diagnose",convertAccordionToTab:false}]};function getHtmlFromTemplate(a,c){if(a===""){return""}$("#htmlContent").loadTemplate(a,c,{ignoreUndefined:true,ignoreNull:true,ignoreEmptyString:true});var b=$("#htmlContent").html();$("#htmlContent").html("");templateItemCount=0;return b}function getTemplateFromType(b){var a;switch(b){case"Button":a="#buttonTmpl";break;case"List":a="#listViewTemplate";break;case"ListItem":a="#listItemTemplate";break;case"SelectMenu":a="#dropdownTemplate";break;case"Collapsible":a="#collapsiblePanelTemplate";break;case"TextInput":case"datetime-local":a="#inputTemplate";break;case"Div":a="#divTemplate";break;case"Accordion":a="#tabTemplate";break;case"RadioGroup":case"CheckboxGroup":case"Checkbox":case"RadioButton":case"Slider":case"ToggleSwitch":case"Text":a="#"+b+"Template";break;default:return""}return a}var textControlText="";function buildHTML(c){var b=c.controls,e=c.sameTypeControls,d=c.parentControl;var a="";if(e===true){var f=b[0].type;return getHtmlFromTemplate(getTemplateFromType(f),b)}$.each(b,function(k,o){var n={},j=null,h=null,l,g,m;$.each(o,function(q,p){if(q==="children"){j=p;if(o.type==="RadioGroup"||o.type==="CheckboxGroup"){$.each(j,function(r,s){if(o.properties.legend!==undefined){s.properties.legend=o.properties.legend}else{if(d!=undefined&&d.properties.heading!==undefined){s.properties.legend=d.properties.heading}else{if(o.properties.heading!==undefined){s.properties.legend=o.properties.heading}else{if(o.type!==undefined){s.properties.legend=o.type}}}}})}}else{n[q]=p}});if(o.type==="Text"){textControlText=o.properties.text}if(o.type==="ToggleSwitch"){o.properties.text=textControlText;textControlText=""}var l=getHtmlFromTemplate(getTemplateFromType(o.type),n);if(j!==null){g=$(l);if(o.type==="RadioGroup"){g.append(buildHTML({controls:j,parentControl:o,sameTypeControls:true}))}else{g.append(buildHTML({controls:j,parentControl:o}))}if(g.length>0){a+=g[0].outerHTML}}else{a+=l}});return a}var tabsControls=defaultTabsControls;var tabControlsToAdd={};tabControlsToAdd.children=[];$(function(){FunctionalityModule&&FunctionalityModule.initialize()});
